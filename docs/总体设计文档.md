## 总体设计文档

书店管理系统 by 朱添翼。

### 程序功能概述

这是一个由 C++ 实现的书店管理系统，利用命令行与用户进行交互，面向三类人员：顾客、销售人员和店长，对不同人员权限提供不同的可执行操作。

### 主体逻辑说明

整个系统分为 4 个模块：

1. 指令分析模块
2. 账户管理模块
3. 图书管理模块
4. 日志模块

运行流程：输入指令 → 指令分析 → 图书数据管理/账户管理/日志管理 → 日志管理 → 输出结果。

### 代码文件结构

`main.cpp` 程序主文件，负责接受指令、终止程序、将指令发送给指令分析模块。

`Command.hpp` 指令分析模块，分析来自 `main.cpp` 的指令，调用其他模块。

`Account.hpp` 账户管理模块，利用块状链表实现账户数据存储，执行来自`Command.hpp` 的调度。

`Book.hpp` 图书管理模块，利用多个块状链表实现图书数据存储，执行来自 `Command.hpp` 的调度。

`Log.hpp` 日志模块，执行来自 `Command.hpp` 的直接调度，还要在其他操作后利用块状链表维护日志。

`BlockList.hpp` 块状链表实现。

`MemoryRiver.hpp` 一个包含空间回收的文件读写类。

### 功能设计

![](https://pic1.imgdb.cn/item/693946946166b811013698f4.png)

### 数据库设计

使用块状链表储存的文件：

`Bookid` 是每本书唯一对应的编号，按出现早晚 1-base 排序。

1. 账户信息文件（Account）：以 `UserID` 为 Key, 以 `账户类` 为 Value.
2. 图书信息文件1（ISBN）：以 `ISBN` 为 Key, 以`Bookid` 为 Value.
3. 图书信息文件2（BookName）：以 `BookName` 为 Key, 以 `Bookid` 为 Value.
4. 图书信息文件3（Author）：以 `Author` 为 Key, 以 `Bookid` 为 Value.
5. 图书信息文件4（Keyword）：以 `Keyword` 为 Key, 以 `Bookid` 为 Value.
6. 员工日志信息文件（EmployeeInfo）：以 `UserID` 为 Key, 以 `员工日志类` 为 Value.

不采用块状链表储存的文件：

1. 图书信息文件0（Books）：以 `Bookid` 为序存储 `图书类` 信息，表头储存书籍总数。
2. 财务信息文件（Finance）：以时间顺序存储 `财务信息类`。
3. 财务报表文件（FinanceTable）：存储 `财务报表类`。
4. 日志文件（Log）：存储 `日志类`。
5. 员工文件（Employees）：按创建顺序储存每个员工 `UserID`，表头存储员工总数。

总计 11 个文件。

### 类、结构体设计

#### 字符串类

均进行 `==` 与 `<` 的重载。

1. 最大长度为 20 的字符串类 `String20`。
2. 最大长度为 30 的字符串类 `String30`。
3. 最大长度为 60 的字符串类 `String60`。

#### 文件读写类

文件读写类 `MemoryRiver`：包含空间回收功能的文件读写类。

#### 块状链表类

块状链表类 `BlockList`：一个封装好的 Key 与 Value 类型可以指定（保证实现了 `<` 与 `==` ），允许插入(`ins`)、删除(`del`)、查找(`query`)。其中包含用于实现块状链表的一些黑箱类，不予展开。

#### 账户相关类

1. 账户类 `Account`：包含 `UserID`(String30)，`password`(String30), `UserName`(String30), `Privilege`(int,1/3/7)。
2. 账户信息类 `AccountStorage`：管理所有账户信息，包含 `BL`（BlockList<UserID,Account>）。

#### 图书相关类

1. 图书类 `Book`：包含 `Bookid`(int), `ISBN`(String20), `BookName`(String60), `Author`(String60), `Keyword`(String60), `number`(int), `price`(double)。
2. 图书信息类 `BookStorage`：管理所有图书信息，包含 `Books`, `BL1`(BlockList<ISBN,Bookid>), `BL2`(BlockList<BookName,Bookid>), `BL3`(BlockList<Author,Bookid>), `BL4`(BlockList<Keyword,Bookid>)。

#### 财务相关类

1. 财务信息类 `Finance`：包含收入与支出的前缀和 `income`(double), `expend`(double)。
2. 财务报表记录类 `FinanceInfo`：包含所有与财务有关的信息，用于制作财务报表。

#### 日志相关类

1. 日志类 `Log`：所有操作信息。
2. 员工日志类 `EmployeeLog`：所有员工日志信息。
3. 日志信息类 `LogStorage`：用于管理所有日志, 包含 `Finance` (财务记录), `FinanceInfo` (财务报表记录), `Log` (日志记录), `Employees` (员工的 `UserID`), `EmployeeInfo` (员工日志记录)

### 补充说明

本项目浮点数精度为小数点后两位。

